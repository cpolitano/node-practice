"use strict";function Profile(e){EventEmitter.call(this),profileEmitter=this;var r=http.get("http://teamtreehouse.com/"+e+".json",function(t){var i="";200!==t.statusCode&&(r.abort(),profileEmitter.emit("error",new Error("There was an error getting the profile for "+e+". ("+http.STATUS_CODES[t.statusCode]+")"))),t.on("data",function(e){i+=e,profileEmitter.emit("data",e)}),t.on("end",function(){if(200===t.statusCode)try{var e=JSON.parse(i);profileEmitter.emit("end",e)}catch(r){profileEmitter.emit("error",r)}}).on("error",function(e){profileEmitter.emit("error",e)})})}function interpolateValues(e,r){for(var t in e)r=r.replace("{{"+t+"}}",e[t]);return r}function view(e,r,t){var i=fs.readFileSync("./views/"+e+".html",{encoding:"utf8"});i=interpolateValues(r,i),t.write(i)}function home(e,r){"/"===e.url&&("get"===e.method.toLowerCase()?(r.writeHead(200,headers),renderer.view("header",{},r),renderer.view("search",{},r),renderer.view("footer",{},r),r.end()):e.on("data",function(e){var t=querystring.parse(e.toString());r.writeHead(303,{Location:"/"+t.username}),r.end()}))}function user(e,r){var t=e.url.replace("/","");if(t.length>0){r.writeHead(200,headers);var i=new Profile(t);i.on("end",function(e){var t={avatarUrl:e.gravatar_url,username:e.profile_name,name:e.name,badges:e.badges.length,javascriptPoints:e.points.JavaScript};renderer.view("header",{},r),renderer.view("profile",t,r),renderer.view("footer",{},r),r.end()}),i.on("error",function(e){renderer.view("header",{},r),renderer.view("error",{errorMessage:e.message},r),renderer.view("search",{},r),renderer.view("footer",{},r),r.end()})}}var http=require("http"),router=require("./router.js"),headers={"Content-Type":"text/html"};http.createServer(function(e,r){r.writeHead(200,headers),router.home(e,r),router.user(e,r)}).listen(3e3),console.log("Server running at http://localhost:3000");var EventEmitter=require("events").EventEmitter,http=require("http"),util=require("util");util.inherits(Profile,EventEmitter),module.exports=Profile;var fs=require("fs");module.exports.view=view;var Profile=require("./profile.js"),renderer=require("./render.js"),querystring=require("querystring"),headers={"Content-Type":"text/html"};module.exports.home=home,module.exports.user=user;